<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Altyapı Futbol Ligleri & Puan Durumları | Futakademi</title>
    <meta name="description" content="Türkiye altyapı futbol liglerinin güncel puan durumlarını, haftalık fikstür ve maç sonuçlarını takip edin.">
    <meta name="keywords" content="altyapı futbol ligleri, u19 ligi puan durumu, fikstür, maç sonuçları, başakşehir u19, türkiye altyapı">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://futakademi.com/ligler.html">
    <meta property="og:title" content="Ligler & Puan Durumları | Futakademi">
    <meta property="og:description" content="Türkiye altyapı futbol liglerinin haftalık fikstür ve puan durumları.">
    <meta property="og:type" content="website">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; min-height: 100vh; }

        /* HEADER */
        .header { position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #0E5384 0%, #0962A2 100%); padding: 15px 5%; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 5px 20px rgba(14,83,132,0.3); z-index: 1000; }
        .header .logo { display: flex; flex-direction: column; align-items: center; gap: 5px; text-decoration: none; }
        .header .logo img { height: 60px; }
        .header .logo span { color: white; font-size: 0.85em; font-weight: 500; letter-spacing: 1px; }
        .header .navbar { display: flex; gap: 30px; }
        .header .navbar a { color: white; text-decoration: none; font-size: 1.1em; font-weight: 600; padding: 10px 20px; border-radius: 8px; transition: all 0.3s ease; }
        .header .navbar a:hover { background: rgba(255,255,255,0.2); }
        .header .navbar a.active { background: white; color: #0E5384; }
        .header .menu-btn { display: none; width: 40px; height: 40px; background: rgba(255,255,255,0.2); border: 2px solid white; border-radius: 8px; cursor: pointer; flex-direction: column; align-items: center; justify-content: center; gap: 4px; }
        .header .menu-btn span { width: 20px; height: 2px; background: white; transition: 0.3s; }
        .header .buttons { display: flex; gap: 15px; }
        .header .buttons button { background: rgba(255,255,255,0.2); border: 2px solid white; color: white; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 1.2em; transition: all 0.3s ease; }
        .header .buttons button:hover { background: white; color: #0E5384; transform: translateY(-3px); }

        /* SEARCH */
        .search-modal { position: fixed; top: 0; left: 0; right: 0; background: white; padding: 20px 5%; box-shadow: 0 5px 20px rgba(0,0,0,0.2); transform: translateY(-100%); transition: transform 0.3s ease; z-index: 999; }
        .search-modal.active { transform: translateY(100px); }
        .search-container { max-width: 800px; margin: 0 auto; position: relative; }
        .search-input { width: 100%; padding: 15px 50px 15px 20px; border: 2px solid #0E5384; border-radius: 10px; font-size: 1.1em; outline: none; }
        .search-close { position: absolute; right: 15px; top: 18px; background: none; border: none; font-size: 1.5em; color: #0E5384; cursor: pointer; }
        .search-results { margin-top: 20px; max-height: 400px; overflow-y: auto; background: white; border-radius: 10px; }
        .search-result-item { padding: 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: background 0.2s; display: flex; justify-content: space-between; align-items: center; }
        .search-result-item:hover { background: #f8f9fa; }
        .search-result-type { background: #0E5384; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.75em; font-weight: 600; }

        /* PAGE */
        .page-header { text-align: center; margin: 120px auto 28px; padding: 0 20px; }
        .page-title { font-size: 2.4em; color: #0E5384; font-weight: 700; margin-bottom: 6px; }
        .page-subtitle { color: #777; font-size: 1em; }

        .container { max-width: 1300px; margin: 0 auto; padding: 0 20px 70px; }

        /* LİG SEÇİCİ */
        .league-selector { background: white; padding: 22px 26px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); margin-bottom: 20px; }
        .league-selector select { width: 100%; padding: 13px 16px; border: 2px solid #e0e0e0; border-radius: 10px; color: #333; font-size: 1em; cursor: pointer; font-family: inherit; background: white; transition: border-color 0.2s; }
        .league-selector select:focus { border-color: #0E5384; outline: none; }

        /* HAFTA NAVİGASYONU */
        .week-nav { background: white; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); margin-bottom: 20px; padding: 18px 22px; }
        .week-nav-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
        .week-nav-label { font-size: 0.8em; color: #999; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .week-nav-arrows { display: flex; gap: 8px; }
        .week-arrow-btn { width: 32px; height: 32px; border-radius: 8px; border: 1.5px solid #e0e0e0; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #555; transition: all 0.15s; font-size: 0.85em; }
        .week-arrow-btn:hover:not(:disabled) { border-color: #0E5384; color: #0E5384; }
        .week-arrow-btn:disabled { opacity: 0.35; cursor: default; }

        .week-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 3px; scrollbar-width: thin; scrollbar-color: #0E5384 #f0f0f0; }
        .week-scroll::-webkit-scrollbar { height: 3px; }
        .week-scroll::-webkit-scrollbar-thumb { background: #0E5384; border-radius: 2px; }

        .week-btn {
            flex-shrink: 0; padding: 8px 16px;
            border: 2px solid #e5e5e5; border-radius: 22px;
            background: white; color: #555;
            font-size: 0.86em; font-weight: 600;
            cursor: pointer; transition: all 0.18s; font-family: inherit;
            white-space: nowrap; position: relative;
        }
        .week-btn:hover { border-color: #0E5384; color: #0E5384; }
        .week-btn.active { background: linear-gradient(135deg,#0E5384,#0962A2); border-color: transparent; color: white; box-shadow: 0 3px 10px rgba(14,83,132,0.3); }
        /* Son oynanmış hafta: yeşil nokta */
        .week-btn.last-played::after { content: ''; position: absolute; top: 4px; right: 6px; width: 6px; height: 6px; border-radius: 50%; background: #27ae60; }
        .week-btn.active.last-played::after { background: #90EE90; }

        /* İÇERİK GRID */
        .content-grid { display: grid; grid-template-columns: 1fr 380px; gap: 20px; align-items: start; }

        /* KART */
        .card { background: white; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); overflow: hidden; }
        .card-head { padding: 18px 22px 14px; border-bottom: 2px solid #f5f5f5; display: flex; align-items: center; justify-content: space-between; }
        .card-head h2 { font-size: 1.08em; font-weight: 700; color: #0E5384; display: flex; align-items: center; gap: 8px; }
        .card-head .badge { font-size: 0.7em; font-weight: 600; padding: 3px 9px; border-radius: 10px; }
        .badge-green { background: #e8f8f0; color: #1e7e4a; }
        .badge-blue  { background: #e8f0fa; color: #0E5384; }
        .badge-grey  { background: #f0f0f0; color: #888; }

        /* PUAN TABLOSU */
        .standings-table { width: 100%; border-collapse: collapse; }
        .standings-table thead tr { background: linear-gradient(135deg,#0E5384,#003C8C); }
        .standings-table th { padding: 11px 8px; color: white; font-weight: 600; font-size: 0.8em; text-align: left; }
        .standings-table th:first-child { padding-left: 18px; }
        .standings-table th:last-child, .standings-table td:last-child { text-align: center; }
        .standings-table tbody tr { border-bottom: 1px solid #f5f5f5; transition: all 0.15s; cursor: pointer; }
        .standings-table tbody tr:last-child { border-bottom: none; }
        .standings-table tbody tr:hover { background: #eef5fc; transform: translateX(3px); }
        .standings-table tbody tr:hover .go-arrow { opacity: 1; }
        .standings-table td { padding: 12px 8px; font-size: 0.86em; color: #333; }
        .standings-table td:first-child { padding-left: 18px; }
        .standings-table td:last-child { font-weight: 800; color: #0E5384; font-size: 0.95em; }

        .tc { display: flex; align-items: center; gap: 9px; }
        .rank-dot { display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 50%; font-weight: 700; font-size: 0.8em; flex-shrink: 0; background: #f0f0f0; color: #777; }
        .rank-dot.gold   { background: linear-gradient(135deg,#FFD700,#FFA500); color: white; }
        .rank-dot.silver { background: linear-gradient(135deg,#C0C0C0,#A8A8A8); color: white; }
        .rank-dot.bronze { background: linear-gradient(135deg,#CD7F32,#B87333); color: white; }
        .rank-dot.rel    { background: linear-gradient(135deg,#e74c3c,#c0392b); color: white; }
        .tn { font-weight: 600; color: #0E5384; }
        .go-arrow { font-size: 0.7em; color: #0962A2; opacity: 0; transition: opacity 0.15s; margin-left: 2px; }

        /* FİKSTÜR / SONUÇLAR */
        .match-list { }
        .match-item { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; padding: 13px 18px; border-bottom: 1px solid #f5f5f5; gap: 10px; transition: background 0.15s; }
        .match-item:last-child { border-bottom: none; }
        .match-item:hover { background: #f8f9fa; }

        .m-home { text-align: right; font-weight: 600; font-size: 0.88em; color: #333; }
        .m-away { text-align: left;  font-weight: 600; font-size: 0.88em; color: #333; }
        .m-home.winner, .m-away.winner { color: #1a9e5a; }
        .m-home.loser,  .m-away.loser  { color: #bbb; font-weight: 500; }

        .m-center { display: flex; flex-direction: column; align-items: center; gap: 3px; flex-shrink: 0; }
        .score-box { background: linear-gradient(135deg,#0E5384,#0962A2); color: white; padding: 5px 13px; border-radius: 7px; font-weight: 800; font-size: 1em; letter-spacing: 2px; min-width: 60px; text-align: center; }
        .vs-box { background: #f0f0f0; color: #aaa; padding: 5px 13px; border-radius: 7px; font-weight: 700; font-size: 0.82em; min-width: 60px; text-align: center; }
        .match-date-label { font-size: 0.68em; color: #bbb; font-weight: 500; }

        /* EMPTY / LOADING */
        .msg-empty { text-align: center; padding: 48px 20px; color: #ccc; }
        .msg-empty i { font-size: 2.4em; display: block; margin-bottom: 12px; }
        .msg-empty p { font-size: 0.92em; }
        .msg-loading { text-align: center; padding: 60px; color: #aaa; font-size: 1em; }

        /* FULL WIDTH placeholder */
        .full-col { grid-column: 1 / -1; }

        /* FOOTER */
        footer { background: linear-gradient(135deg,#0E5384 0%,#003C8C 100%); color: white; padding: 40px 5%; }
        .footer-content { display: flex; justify-content: space-between; align-items: center; max-width: 1300px; margin: 0 auto; padding-bottom: 26px; border-bottom: 1px solid rgba(255,255,255,0.2); flex-wrap: wrap; gap: 20px; }
        .footer-logo-and-social h2 { font-size: 1.8em; margin-bottom: 18px; font-weight: 700; }
        .social-media { display: flex; gap: 14px; }
        .social-link { width: 44px; height: 44px; background: rgba(255,255,255,0.18); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2em; text-decoration: none; transition: all 0.2s; }
        .social-link:hover { background: white; color: #0E5384; transform: translateY(-4px); }
        .footer-links { display: flex; gap: 28px; }
        .footer-link { color: rgba(255,255,255,0.88); text-decoration: none; font-size: 1.05em; font-weight: 500; transition: opacity 0.2s; }
        .footer-link:hover { opacity: 0.75; }
        .footer-bottom { text-align: center; padding-top: 18px; }
        .footer-bottom .rights { color: rgba(255,255,255,0.65); font-size: 0.88em; }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .content-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .header .menu-btn { display: flex; }
            .header .navbar { position: fixed; top: 80px; right: -100%; width: 280px; height: calc(100vh - 80px); background: linear-gradient(135deg,#0E5384,#0962A2); flex-direction: column; padding: 20px; transition: right 0.3s; box-shadow: -5px 0 20px rgba(0,0,0,0.3); z-index: 999; gap: 0; }
            .header .navbar.active { right: 0; }
            .header .navbar a { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); width: 100%; }
            .header .buttons { position: fixed; top: auto; right: -100%; bottom: 80px; width: 280px; flex-direction: column; padding: 20px; gap: 15px; background: rgba(14,83,132,0.95); transition: right 0.3s; z-index: 999; border-top: 1px solid rgba(255,255,255,0.2); }
            .header .buttons.active { right: 0; }
            .header .buttons button { width: 100%; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
            .header .buttons button::after { content: attr(aria-label); font-family: 'Segoe UI', sans-serif; }
            .header { padding: 15px 3%; }
            .header .logo img { height: 50px; }
            .page-header { margin: 108px auto 20px; }
            .page-title { font-size: 1.9em; }
            .container { padding: 0 12px 50px; }
            .standings-table th, .standings-table td { padding: 9px 5px; font-size: 0.78em; }
            .match-item { padding: 11px 14px; }
            .m-home, .m-away { font-size: 0.8em; }
            .go-arrow { display: none; }
            .footer-content { flex-direction: column; text-align: center; }
            .footer-links { flex-direction: column; gap: 14px; }
            .social-media { justify-content: center; }
        }
    </style>
</head>
<body>

<header class="header">
    <a href="anasayfa.html" class="logo">
        <img src="images/logo.png" alt="FutAkademi Logo">
        <span>futakademi</span>
    </a>
    <button class="menu-btn" onclick="toggleMenu(event)"><span></span><span></span><span></span></button>
    <nav class="navbar">
        <a href="anasayfa.html">Ana Sayfa</a>
        <a href="ligler.html" class="active">Ligler</a>
        <a href="istatistikler.html">İstatistikler</a>
        <a href="haber.html">Haberler</a>
        <a href="blog.html">Gelişim</a>
    </nav>
    <div class="buttons">
        <button aria-label="Arama" onclick="openSearch()"><i class="fa-solid fa-magnifying-glass"></i></button>
        <button aria-label="Kaydedilenler"><i class="fa-solid fa-bookmark"></i></button>
        <button aria-label="Hesabım" onclick="handleUserIcon()"><i class="fa-solid fa-user"></i></button>
    </div>
</header>

<div class="search-modal" id="searchModal">
    <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="Takım veya lig ara...">
        <button class="search-close" onclick="closeSearch()"><i class="fa-solid fa-times"></i></button>
        <div class="search-results" id="searchResults"></div>
    </div>
</div>

<div class="page-header">
    <h1 class="page-title">Ligler</h1>
    <p class="page-subtitle">Haftalık fikstür, maç sonuçları ve puan durumu</p>
</div>

<div class="container">
    <!-- LİG SEÇİCİ -->
    <div class="league-selector">
        <select id="ligSec" onchange="onLeagueChange()">
            <option value="" disabled selected>Lig yükleniyor...</option>
        </select>
    </div>

    <!-- HAFTA NAVİGASYONU -->
    <div class="week-nav" id="weekNav" style="display:none">
        <div class="week-nav-top">
            <span class="week-nav-label"><i class="fas fa-calendar-week"></i>&nbsp; Hafta Seçin</span>
            <div class="week-nav-arrows">
                <button class="week-arrow-btn" id="prevWeekBtn" onclick="shiftWeek(-1)" title="Önceki hafta"><i class="fas fa-chevron-left"></i></button>
                <button class="week-arrow-btn" id="nextWeekBtn" onclick="shiftWeek(1)"  title="Sonraki hafta"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
        <div class="week-scroll" id="weekScroll"></div>
    </div>

    <!-- PUAN + FİKSTÜR -->
    <div class="content-grid" id="contentGrid">
        <div class="msg-loading full-col"><i class="fas fa-spinner fa-spin"></i> Yükleniyor...</div>
    </div>
</div>

<footer>
    <div class="footer-content">
        <div class="footer-logo-and-social">
            <h2>FUTAKADEMİ</h2>
            <div class="social-media">
                <a href="https://www.instagram.com/fut.akademi/" class="social-link"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-link"><i class="fa-brands fa-x-twitter"></i></a>
                <a href="#" class="social-link"><i class="fa-brands fa-youtube"></i></a>
            </div>
        </div>
        <div class="footer-links">
            <a href="hakkımızda.html" class="footer-link">Hakkımızda</a>
            <a href="iletişim.html" class="footer-link">İletişim</a>
        </div>
    </div>
    <div class="footer-bottom"><p class="rights">© Tüm Hakları Saklıdır 2025 futakademi.com</p></div>
</footer>

<script>
const API = 'https://backend-production-40a7.up.railway.app/api/v1';

// ── STATE ──
let allLeagues    = [];
let currentLeague = null;   // {id, name, season}
let allWeeks      = [];     // [1,2,3,...]  hafta numaraları
let activeWeek    = null;   // seçili hafta
let lastPlayedWeek= null;   // en son oynanan hafta (backend'den gelir)
let currentStandings = [];  // arama için cache

// ── HEADER ──
function getToken() { return localStorage.getItem('futa_token') || sessionStorage.getItem('futa_token'); }
function handleUserIcon() { window.location.href = getToken() ? 'hesabim.html' : 'giris.html'; }
function toggleMenu(e) {
    e.stopPropagation();
    document.querySelector('.navbar').classList.toggle('active');
    document.querySelector('.buttons').classList.toggle('active');
}
document.addEventListener('click', e => {
    if (!e.target.closest('.navbar') && !e.target.closest('.buttons') && !e.target.closest('.menu-btn')) {
        document.querySelector('.navbar')?.classList.remove('active');
        document.querySelector('.buttons')?.classList.remove('active');
    }
});

// ── SEARCH ──
function openSearch() { document.getElementById('searchModal').classList.add('active'); document.getElementById('searchInput').focus(); }
function closeSearch() {
    document.getElementById('searchModal').classList.remove('active');
    document.getElementById('searchInput').value = '';
    document.getElementById('searchResults').innerHTML = '';
}
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeSearch(); });
document.getElementById('searchInput').addEventListener('input', function () {
    const q = this.value.toLowerCase().trim();
    const r = document.getElementById('searchResults');
    if (q.length < 2) { r.innerHTML = ''; return; }
    const ligRes  = allLeagues.filter(l => l.name.toLowerCase().includes(q));
    const teamRes = currentStandings.filter(t => t.name.toLowerCase().includes(q));
    let html = '';
    ligRes.forEach(l => {
        html += `<div class="search-result-item" onclick="selectLeagueById('${l.id}')"><strong>${l.name}</strong><span class="search-result-type">${l.season||'Lig'}</span></div>`;
    });
    teamRes.forEach(t => {
        html += `<div class="search-result-item" onclick="goTeam('${t.id}','${esc(t.name)}')"><strong>${t.name}</strong><span class="search-result-type">Takım</span></div>`;
    });
    r.innerHTML = html || '<div class="search-result-item">Sonuç bulunamadı</div>';
});

function esc(s) { return (s||'').replace(/'/g,"\\'"); }

function goTeam(id, name) {
    closeSearch();
    if (!currentLeague) return;
    const p = new URLSearchParams({ id, takim: name, ligId: currentLeague.id, ligAdi: currentLeague.name, sezon: currentLeague.season||'' });
    window.location.href = 'takimprofile.html?' + p.toString();
}

// ── LİGLERİ YÜKLE ──
async function init() {
    try {
        const res  = await fetch(`${API}/leagues`);
        allLeagues = await res.json();
        if (!Array.isArray(allLeagues)) allLeagues = allLeagues.data || [];

        const sel = document.getElementById('ligSec');
        if (!allLeagues.length) {
            sel.innerHTML = '<option disabled selected>Lig bulunamadı</option>';
            setGrid('<div class="msg-empty full-col"><i class="fas fa-futbol"></i><p>Henüz lig eklenmemiş.</p></div>');
            return;
        }
        sel.innerHTML = allLeagues.map((l,i) =>
            `<option value="${l.id}" ${i===0?'selected':''}>${l.name}${l.season?' — '+l.season:''}</option>`
        ).join('');
        await loadLeague(allLeagues[0]);
    } catch {
        setGrid('<div class="msg-empty full-col"><i class="fas fa-wifi"></i><p>Bağlantı hatası.</p></div>');
    }
}

async function onLeagueChange() {
    const sel = document.getElementById('ligSec');
    const l = allLeagues.find(l => l.id === sel.value);
    if (l) await loadLeague(l);
}

function selectLeagueById(id) {
    closeSearch();
    const l = allLeagues.find(l => l.id === id);
    if (!l) return;
    document.getElementById('ligSec').value = id;
    loadLeague(l);
}

// ── LİG YÜKLENDİĞİNDE ──
async function loadLeague(league) {
    currentLeague = league;
    allWeeks = [];
    activeWeek = null;
    lastPlayedWeek = null;
    currentStandings = [];
    document.getElementById('weekNav').style.display = 'none';
    setGrid('<div class="msg-loading full-col"><i class="fas fa-spinner fa-spin"></i> Yükleniyor...</div>');

    try {
        const res = await fetch(`${API}/leagues/${league.id}/weeks`);
        if (!res.ok) throw new Error('no_weeks_endpoint');
        const data = await res.json();
        allWeeks = Array.isArray(data) ? data.sort((a,b)=>a-b) : [];
    } catch {
        // /weeks endpoint'i yoksa (eski backend) → sadece standings göster
        await showStandingsOnly();
        return;
    }

    if (!allWeeks.length) {
        // Maç girilmemiş → standings'i normal göster
        await showStandingsOnly();
        return;
    }

    // Hafta butonlarını oluştur — lastPlayedWeek'i bilmek için
    // İlk olarak son haftanın datasını çekip lastPlayedWeek'i öğrenelim
    await fetchWeekAndShow(allWeeks[allWeeks.length - 1], true /* ilk yüklemede son oynanmışa geç */);
}

// ── HAFTA VERİSİNİ ÇEK ve GÖSTER ──
async function fetchWeekAndShow(week, jumpToLastPlayed = false) {
    setGrid('<div class="msg-loading full-col"><i class="fas fa-spinner fa-spin"></i> Yükleniyor...</div>');

    try {
        const res = await fetch(`${API}/leagues/${currentLeague.id}/weeks/${week}`);
        if (!res.ok) throw new Error();
        const data = await res.json();

        // lastPlayedWeek backend'den gelir
        lastPlayedWeek = data.lastPlayedWeek ?? null;

        // Hafta butonlarını render et (lastPlayedWeek belli oldu)
        renderWeekButtons();
        document.getElementById('weekNav').style.display = 'block';

        // İlk yüklemede: son oynanmış haftaya geç, yoksa ilk haftaya
        if (jumpToLastPlayed) {
            const targetWeek = lastPlayedWeek ?? allWeeks[0];
            if (targetWeek !== week) {
                activeWeek = targetWeek;
                highlightWeekBtn(targetWeek);
                // O haftanın datasını çek (puan durumu doğru olsun)
                const res2 = await fetch(`${API}/leagues/${currentLeague.id}/weeks/${targetWeek}`);
                const data2 = await res2.json();
                currentStandings = data2.standings || [];
                renderContent(data2, targetWeek);
                return;
            }
        }

        activeWeek = week;
        highlightWeekBtn(week);
        currentStandings = data.standings || [];
        renderContent(data, week);

    } catch {
        setGrid('<div class="msg-empty full-col"><i class="fas fa-exclamation-triangle"></i><p>Veri yüklenemedi.</p></div>');
    }
}

// Hafta seçildi
async function selectWeek(w) {
    if (activeWeek === w) return;
    activeWeek = w;
    highlightWeekBtn(w);
    updateArrowBtns();
    await fetchWeekAndShow(w);
}

function shiftWeek(dir) {
    const idx = allWeeks.indexOf(activeWeek);
    const next = allWeeks[idx + dir];
    if (next !== undefined) selectWeek(next);
}

function renderWeekButtons() {
    const scroll = document.getElementById('weekScroll');
    scroll.innerHTML = allWeeks.map(w => {
        const isLast = (w === lastPlayedWeek);
        return `<button class="week-btn${isLast?' last-played':''}" id="wb-${w}" onclick="selectWeek(${w})" title="${w}. Hafta${isLast?' (son oynanmış hafta)':''}">${w}. Hafta</button>`;
    }).join('');
    updateArrowBtns();
}

function highlightWeekBtn(w) {
    document.querySelectorAll('.week-btn').forEach(b => b.classList.remove('active'));
    const btn = document.getElementById(`wb-${w}`);
    if (btn) {
        btn.classList.add('active');
        btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    }
}

function updateArrowBtns() {
    const idx = allWeeks.indexOf(activeWeek);
    const prevBtn = document.getElementById('prevWeekBtn');
    const nextBtn = document.getElementById('nextWeekBtn');
    if (prevBtn) prevBtn.disabled = (idx <= 0);
    if (nextBtn) nextBtn.disabled = (idx >= allWeeks.length - 1);
}

// ── İÇERİK RENDER ──
function renderContent(data, week) {
    const { matches = [], standings = [] } = data;
    const total = standings.length;

    // Bu hafta oynanmış maç var mı?
    const playedCount   = matches.filter(m => m.homeScore !== null).length;
    const upcomingCount = matches.filter(m => m.homeScore === null).length;
    const isAllPlayed   = playedCount > 0 && upcomingCount === 0;
    const isAllUpcoming = playedCount === 0;
    const isMixed       = playedCount > 0 && upcomingCount > 0;

    // Puan durumu başlığı: her zaman "lastPlayedWeek. hafta sonrası"
    const standingsSubtitle = lastPlayedWeek
        ? `${lastPlayedWeek}. hafta sonrası`
        : 'Henüz maç oynanmadı';

    // Fikstür başlığı
    let fixtureTitle, fixtureBadge, fixtureBadgeClass;
    if (isAllPlayed) {
        fixtureTitle = `${week}. Hafta Sonuçları`;
        fixtureBadge = 'Tamamlandı'; fixtureBadgeClass = 'badge-green';
    } else if (isAllUpcoming) {
        fixtureTitle = `${week}. Hafta Fikstürü`;
        fixtureBadge = 'Oynanmadı'; fixtureBadgeClass = 'badge-grey';
    } else {
        fixtureTitle = `${week}. Hafta`;
        fixtureBadge = 'Devam Ediyor'; fixtureBadgeClass = 'badge-blue';
    }

    document.getElementById('contentGrid').innerHTML = `
        <!-- SOL: PUAN DURUMU (daima lastPlayedWeek birikimli) -->
        <div class="card">
            <div class="card-head">
                <h2><i class="fas fa-list-ol"></i> Puan Durumu</h2>
                <span class="badge badge-grey">${standingsSubtitle}</span>
            </div>
            ${standings.length ? `
            <table class="standings-table">
                <thead>
                    <tr>
                        <th>Takım</th>
                        <th>O</th><th>G</th><th>B</th><th>M</th>
                        <th>AG</th><th>YG</th><th>AV</th><th>P</th>
                    </tr>
                </thead>
                <tbody>
                    ${standings.map((t,i) => {
                        const rank = i+1, av = t.goalsFor-t.goalsAgainst;
                        let dc='';
                        if(rank===1)dc='gold';else if(rank===2)dc='silver';else if(rank===3)dc='bronze';else if(rank>=total-2)dc='rel';
                        return `<tr onclick="goTeam('${t.id}','${esc(t.name)}')" title="${t.name} profiline git">
                            <td><div class="tc">
                                <span class="rank-dot ${dc}">${rank}</span>
                                <span class="tn">${t.name}</span>
                                <span class="go-arrow"><i class="fas fa-arrow-right"></i></span>
                            </div></td>
                            <td>${t.played}</td><td>${t.win}</td><td>${t.draw}</td><td>${t.loss}</td>
                            <td>${t.goalsFor}</td><td>${t.goalsAgainst}</td>
                            <td>${av>0?'+'+av:av}</td>
                            <td>${t.points}</td>
                        </tr>`;
                    }).join('')}
                </tbody>
            </table>` : `
            <div class="msg-empty" style="padding:36px">
                <i class="fas fa-info-circle"></i>
                <p>Henüz maç oynanmamış.</p>
            </div>`}
        </div>

        <!-- SAĞ: FİKSTÜR / SONUÇLAR -->
        <div class="card">
            <div class="card-head">
                <h2><i class="fas fa-${isAllPlayed?'flag-checkered':'calendar-alt'}"></i> ${fixtureTitle}</h2>
                <span class="badge ${fixtureBadgeClass}">${fixtureBadge}</span>
            </div>
            ${matches.length ? `
            <div class="match-list">
                ${matches.map(m => renderMatch(m)).join('')}
            </div>` : `
            <div class="msg-empty">
                <i class="fas fa-futbol"></i>
                <p>Bu hafta için maç girilmemiş.</p>
            </div>`}
        </div>
    `;
}

function renderMatch(m) {
    const played = m.homeScore !== null && m.awayScore !== null;
    const home   = m.homeTeam?.name || '—';
    const away   = m.awayTeam?.name || '—';

    let homeClass = '', awayClass = '';
    if (played) {
        if      (m.homeScore > m.awayScore) { homeClass = 'winner'; awayClass = 'loser'; }
        else if (m.homeScore < m.awayScore) { awayClass = 'winner'; homeClass = 'loser'; }
    }

    const scoreHtml = played
        ? `<div class="score-box">${m.homeScore} – ${m.awayScore}</div>`
        : `<div class="vs-box">vs</div>`;

    let dateLabel = '';
    if (m.playedAt) {
        const d = new Date(m.playedAt);
        dateLabel = d.toLocaleDateString('tr-TR', { day:'2-digit', month:'short' });
        if (!played) {
            dateLabel += ' ' + d.toLocaleTimeString('tr-TR', { hour:'2-digit', minute:'2-digit' });
        }
    }

    return `
    <div class="match-item">
        <div class="m-home ${homeClass}">${home}</div>
        <div class="m-center">
            ${scoreHtml}
            ${dateLabel ? `<div class="match-date-label">${dateLabel}</div>` : ''}
        </div>
        <div class="m-away ${awayClass}">${away}</div>
    </div>`;
}

// ── FALLBACK: Hafta yoksa sadece standings ──
async function showStandingsOnly() {
    document.getElementById('weekNav').style.display = 'none';
    try {
        const res  = await fetch(`${API}/leagues/${currentLeague.id}/standings`);
        const data = await res.json();
        const teams = (data.teams||[]).sort((a,b) => {
            if (b.points!==a.points) return b.points-a.points;
            return (b.goalsFor-b.goalsAgainst)-(a.goalsFor-a.goalsAgainst);
        });
        currentStandings = teams;
        const total = teams.length;

        setGrid(`
            <div class="card full-col">
                <div class="card-head">
                    <h2><i class="fas fa-list-ol"></i> ${currentLeague.name}${currentLeague.season?' — '+currentLeague.season:''} Puan Durumu</h2>
                    <span class="badge badge-grey">Genel</span>
                </div>
                ${teams.length ? `
                <table class="standings-table">
                    <thead><tr>
                        <th>Takım</th><th>O</th><th>G</th><th>B</th><th>M</th>
                        <th>AG</th><th>YG</th><th>AV</th><th>P</th>
                    </tr></thead>
                    <tbody>
                    ${teams.map((t,i)=>{
                        const rank=i+1, av=(t.goalsFor||0)-(t.goalsAgainst||0);
                        let dc='';
                        if(rank===1)dc='gold';else if(rank===2)dc='silver';else if(rank===3)dc='bronze';else if(rank>=total-2)dc='rel';
                        return `<tr onclick="goTeam('${t.id}','${esc(t.name)}')" title="${t.name} profiline git">
                            <td><div class="tc"><span class="rank-dot ${dc}">${rank}</span><span class="tn">${t.name}</span><span class="go-arrow"><i class="fas fa-arrow-right"></i></span></div></td>
                            <td>${t.played??0}</td><td>${t.win??0}</td><td>${t.draw??0}</td><td>${t.loss??0}</td>
                            <td>${t.goalsFor??0}</td><td>${t.goalsAgainst??0}</td>
                            <td>${av>0?'+'+av:av}</td><td>${t.points??0}</td>
                        </tr>`;
                    }).join('')}
                    </tbody>
                </table>
                <p style="text-align:center;padding:14px 0;font-size:0.78em;color:#bbb">
                    Haftalık fikstür verisi için admin panelinden maç girilmesi gerekiyor.
                </p>` : `
                <div class="msg-empty"><i class="fas fa-users-slash"></i><p>Bu ligde henüz takım yok.</p></div>`}
            </div>
        `);
    } catch {
        setGrid('<div class="msg-empty full-col"><i class="fas fa-wifi"></i><p>Bağlantı hatası.</p></div>');
    }
}

function setGrid(html) {
    document.getElementById('contentGrid').innerHTML = html;
}

window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
