generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  free
  premium
  admin
}

enum VerificationStatus {
  none
  pending_identity
  pending_admin_review
  approved
  rejected
}

enum ClaimStatus {
  pending_identity
  pending_admin_review
  approved
  rejected
}

enum PostCategory {
  haber
  gelisim
}

enum PostStatus {
  draft
  published
}

model User {
  id                  String             @id @default(uuid())
  email               String             @unique
  passwordHash        String
  role                Role               @default(free)
  subscriptionStart   DateTime?
  subscriptionEnd     DateTime?
  verificationStatus  VerificationStatus @default(none)
  claimedPlayerId     String?            @unique
  claimAttempts       Int                @default(0)
  createdAt           DateTime           @default(now())

  claimedPlayer       Player?            @relation("ClaimedPlayer", fields: [claimedPlayerId], references: [id])
  claimRequests       ClaimRequest[]
  identityVerifications IdentityVerification[]

  @@index([email])
}

model Player {
  id          String   @id @default(uuid())
  tffId       String   @unique
  firstName   String
  lastName    String
  birthYear   Int
  club        String
  league      String
  position    String
  matches     Int      @default(0)
  goals       Int      @default(0)
  assists     Int      @default(0)
  isClaimed   Boolean  @default(false)
  claimedById String?
  createdAt   DateTime @default(now())

  claimedByUser PlayerClaimedBy? @relation("PlayerClaimedBy")
  claimedUser   User?            @relation("ClaimedPlayer")
  customData    PlayerCustomData?
  claimRequests ClaimRequest[]

  @@index([firstName, lastName])
  @@index([club])
  @@index([position])
  @@index([league])
  @@index([birthYear])
}

model PlayerClaimedBy {
  playerId String @id
  userId   String @unique

  player Player @relation("PlayerClaimedBy", fields: [playerId], references: [id])

  @@map("player_claimed_by")
}

model PlayerCustomData {
  id            String   @id @default(uuid())
  playerId      String   @unique
  bio           String?
  height        Float?
  weight        Float?
  preferredFoot String?
  videoUrl      String?
  instagram     String?
  extraStats    Json?
  updatedAt     DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id])
}

model ClaimRequest {
  id         String      @id @default(uuid())
  userId     String
  playerId   String
  status     ClaimStatus @default(pending_identity)
  createdAt  DateTime    @default(now())
  reviewedAt DateTime?

  user   User   @relation(fields: [userId], references: [id])
  player Player @relation(fields: [playerId], references: [id])

  @@index([userId])
  @@index([status])
}

model IdentityVerification {
  id        String   @id @default(uuid())
  userId    String
  tcknHash  String
  firstName String
  lastName  String
  birthYear Int
  nviResult Boolean
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Post {
  id         String       @id @default(uuid())
  title      String
  slug       String       @unique
  content    String
  coverImage String?
  category   PostCategory
  status     PostStatus   @default(draft)
  viewCount  Int          @default(0)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@index([slug])
  @@index([category])
  @@index([status])
}

model League {
  id        String   @id @default(uuid())
  name      String
  season    String
  createdAt DateTime @default(now())

  teams Team[]

  @@unique([name, season])
}

model Team {
  id           String @id @default(uuid())
  leagueId     String
  name         String
  played       Int    @default(0)
  win          Int    @default(0)
  draw         Int    @default(0)
  loss         Int    @default(0)
  goalsFor     Int    @default(0)
  goalsAgainst Int    @default(0)
  points       Int    @default(0)

  league League @relation(fields: [leagueId], references: [id])

  @@index([leagueId])
}

model AdminAuditLog {
  id         String   @id @default(uuid())
  adminId    String
  action     String
  targetType String
  targetId   String
  meta       Json?
  createdAt  DateTime @default(now())

  @@index([adminId])
  @@index([createdAt])
}
